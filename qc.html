<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Fitting new models (--fit-model)" href="model_fitting.html" /><link rel="prev" title="Sketching (--create-db)" href="sketching.html" />

    <!-- Generated with Sphinx 7.1.2 and Furo 2023.09.10 -->
        <title>Data quality control (--qc-db) - PopPUNK 2.6.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">PopPUNK 2.6.2 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/poppunk_v2.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">PopPUNK 2.6.2 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">PopPUNK documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="sketching.html">Sketching (<code class="docutils literal notranslate"><span class="pre">--create-db</span></code>)</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Data quality control (<code class="docutils literal notranslate"><span class="pre">--qc-db</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_fitting.html">Fitting new models (<code class="docutils literal notranslate"><span class="pre">--fit-model</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_distribution.html">Distributing PopPUNK models</a></li>
<li class="toctree-l1"><a class="reference internal" href="query_assignment.html">Query assignment (<code class="docutils literal notranslate"><span class="pre">poppunk_assign</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualisation.html">Creating visualisations</a></li>
<li class="toctree-l1"><a class="reference internal" href="mst.html">Minimum spanning trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="subclustering.html">Subclustering with PopPIPE</a></li>
<li class="toctree-l1"><a class="reference internal" href="gpu.html">Using GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="poppunk_iterate.html">Iterative PopPUNK</a></li>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citing PopPUNK</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Reference documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="miscellaneous.html">Miscellaneous</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="data-quality-control-qc-db">
<h1>Data quality control (<code class="docutils literal notranslate"><span class="pre">--qc-db</span></code>)<a class="headerlink" href="#data-quality-control-qc-db" title="Permalink to this heading">#</a></h1>
<p>PopPUNK now comes with some basic quality control options, which you should
run on your sketch database made with <code class="docutils literal notranslate"><span class="pre">--create-db</span></code> by running <code class="docutils literal notranslate"><span class="pre">--qc-db</span></code>
as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">poppunk</span> <span class="o">--</span><span class="n">qc</span><span class="o">-</span><span class="n">db</span> <span class="o">--</span><span class="n">ref</span><span class="o">-</span><span class="n">db</span> <span class="n">example_db</span> <span class="o">--</span><span class="nb">type</span><span class="o">-</span><span class="n">isolate</span> <span class="mi">12754_4_79</span> <span class="o">--</span><span class="n">length</span><span class="o">-</span><span class="nb">range</span> <span class="mi">2000000</span> <span class="mi">3000000</span>
</pre></div>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">poppunk_assign</span></code>, instead add <code class="docutils literal notranslate"><span class="pre">--run-qc</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">poppunk_assign</span> <span class="o">--</span><span class="n">query</span> <span class="n">queries</span><span class="o">.</span><span class="n">txt</span> <span class="o">--</span><span class="n">db</span> <span class="n">example_db</span> <span class="o">--</span><span class="n">run</span><span class="o">-</span><span class="n">qc</span> <span class="o">--</span><span class="nb">max</span><span class="o">-</span><span class="n">zero</span><span class="o">-</span><span class="n">dist</span> <span class="mi">1</span> <span class="o">--</span><span class="nb">max</span><span class="o">-</span><span class="n">merge</span> <span class="mi">3</span>
</pre></div>
</div>
<p>The following criteria are available:</p>
<ul class="simple">
<li><p>Outlying genome length (calculated during sketching, for assemblies or reads) with <code class="docutils literal notranslate"><span class="pre">--length-range</span></code> and/or <code class="docutils literal notranslate"><span class="pre">--length-sigma</span></code>.</p></li>
<li><p>Too many ‘N’s with <code class="docutils literal notranslate"><span class="pre">--prop-n</span></code> and/or <code class="docutils literal notranslate"><span class="pre">--upper-n</span></code>.</p></li>
<li><p>Outlying core or accessory distances with <code class="docutils literal notranslate"><span class="pre">--max-pi-dist</span></code> and <code class="docutils literal notranslate"><span class="pre">--max-a-dist</span></code> respectively.</p></li>
<li><p>Too many zero distances with <code class="docutils literal notranslate"><span class="pre">--max-zero-dist</span></code>.</p></li>
</ul>
<p>For <code class="docutils literal notranslate"><span class="pre">poppunk</span> <span class="pre">--create-db</span></code> only:</p>
<ul class="simple">
<li><p>Names of samples to remove (e.g. failing external QC) with <code class="docutils literal notranslate"><span class="pre">--remove-samples</span></code>.</p></li>
</ul>
<p>For <code class="docutils literal notranslate"><span class="pre">poppunk_assign</span></code> only:</p>
<ul class="simple">
<li><p>Maximum number of clusters a single isolate can cause to merge with <code class="docutils literal notranslate"><span class="pre">--max-merge</span></code>.</p></li>
<li><p>Betweenness of queries (not automated, just reported) with <code class="docutils literal notranslate"><span class="pre">--betweenness</span></code>.</p></li>
</ul>
<p>In all cases a file will be written at <code class="docutils literal notranslate"><span class="pre">qcreport.txt</span></code> which lists the failing samples, and the
reasons why they failed. Adding <code class="docutils literal notranslate"><span class="pre">--qc-keep</span></code> will
only write the file and not remove failing samples.
You may also add <code class="docutils literal notranslate"><span class="pre">--retain-failures</span></code>
to write a separate sketch database with the failed samples.</p>
<p>Random match chances in PopPUNK are only calculated and added to the database after the chosen
QC step. If you use <code class="docutils literal notranslate"><span class="pre">sketchlib</span></code> directly, they will be added without any automated QC.</p>
<section id="qc-of-input-sequences">
<h2>QC of input sequences<a class="headerlink" href="#qc-of-input-sequences" title="Permalink to this heading">#</a></h2>
<p>The first QC step is applied directly to the input sequences themselves, to identify poor
quality sequences.</p>
<p>You can change the genome length cutoff with <code class="docutils literal notranslate"><span class="pre">--length-sigma</span></code> which sets the maximum number
of standard deviations from the mean, and <code class="docutils literal notranslate"><span class="pre">--length-range</span></code> which sets an absolute range of
allowable sizes.</p>
<p>Ambiguous bases are controlled by <code class="docutils literal notranslate"><span class="pre">--prop-n</span></code> which gives the maximum percentage of Ns,
and <code class="docutils literal notranslate"><span class="pre">--upper-n</span></code> which gives the absolute maximum value.</p>
</section>
<section id="qc-of-pairwise-distances">
<h2>QC of pairwise distances<a class="headerlink" href="#qc-of-pairwise-distances" title="Permalink to this heading">#</a></h2>
<p>The second QC step uses the pairwise distances, to enable the removal of outlier samples
that may not be part of the taxon being studied. This is with reference to a type
isolate. The type isolate will be selected by PopPUNK, unless specified using <code class="docutils literal notranslate"><span class="pre">--type-isolate</span></code>.</p>
<p>By default, the maximum allowed accessory distance is 0.5 to ensure you check for contamination.
However, many species do really have high accessory values above this range, in which case you
should increase the value of <code class="docutils literal notranslate"><span class="pre">--max-a-dist</span></code>.</p>
<p>The maximum allowed core distance is also 0.5, by default. This can be altered with <code class="docutils literal notranslate"><span class="pre">--max-pi-dist</span></code>.</p>
<p>All sequences differing from the type isolate by distances greater than either threshold will be
identified by the analysis.</p>
<p>Each isolate may have a proportion of distances that are exactly zero as set by
<code class="docutils literal notranslate"><span class="pre">--max-zero-dist</span></code>.</p>
</section>
<section id="qc-of-the-network-assign-only">
<h2>QC of the network (assign only)<a class="headerlink" href="#qc-of-the-network-assign-only" title="Permalink to this heading">#</a></h2>
<p>Finally, you may also check network properties.</p>
<p>Maximum number of clusters a single isolate can cause to merge is
set with <code class="docutils literal notranslate"><span class="pre">--max-merge</span></code>. More than this number of links across the original clusters
will result in removal of the isolate.</p>
<p>Betweenness of queries can be reported with <code class="docutils literal notranslate"><span class="pre">--betweenness</span></code>, which may be useful
to prune the input in more complex cases. This does not cause automated removal as
it’s difficult to set a sensible threshold across datasets.
You will therefore need to re-run and remove samples yourself.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="model_fitting.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Fitting new models (<code class="docutils literal notranslate"><span class="pre">--fit-model</span></code>)</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="sketching.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Sketching (<code class="docutils literal notranslate"><span class="pre">--create-db</span></code>)</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2018-2023, John Lees and Nicholas Croucher
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Data quality control (<code class="docutils literal notranslate"><span class="pre">--qc-db</span></code>)</a><ul>
<li><a class="reference internal" href="#qc-of-input-sequences">QC of input sequences</a></li>
<li><a class="reference internal" href="#qc-of-pairwise-distances">QC of pairwise distances</a></li>
<li><a class="reference internal" href="#qc-of-the-network-assign-only">QC of the network (assign only)</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=1fc3131f"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/scripts/furo.js?v=32e29ea5"></script>
    </body>
</html>